<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotating Textured Sphere</title>
    <style>
        body { margin: 0; background-color: black; }
        #container { width: 256px; height: 256px; background-color: rgb(29, 41, 29); }
        canvas { display: block; }
    </style>
    <!-- Include the main Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Include the DDSLoader from the Three.js examples directory -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DDSLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
</head>
<body>
    <div id="container"></div>
    <script>
        const container = document.getElementById('container');

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 1, 2);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        const ddsLoader = new THREE.DDSLoader();
        const fbxLoader = new THREE.FBXLoader();

        let diffuseTexture, normalTexture, roughnessTexture;
        let material;

        // Load Textures and Initialize Material
        function loadTexturesAndInitialize() {
            return Promise.all([
                new Promise((resolve, reject) => {
                    ddsLoader.load('textures/planets/continental_05_diffuse.dds', resolve, undefined, reject);
                }).then((texture) => {
                    diffuseTexture = texture;
                    console.log('Diffuse texture loaded successfully');
                }),
                new Promise((resolve, reject) => {
                    ddsLoader.load('textures/planets/continental_05_normals.dds', resolve, undefined, reject);
                }).then((texture) => {
                    normalTexture = texture;
                    console.log('Normal texture loaded successfully');
                }),
                new Promise((resolve, reject) => {
                    ddsLoader.load('textures/planets/continental_05_spec.dds', resolve, undefined, reject);
                }).then((texture) => {
                    roughnessTexture = texture;
                    console.log('Roughness texture loaded successfully');
                })
            ]).then(() => {
                material = new THREE.MeshStandardMaterial({
                    map: diffuseTexture,
                    normalMap: normalTexture,
                    roughnessMap: roughnessTexture,
                    roughness: 1.0,
                    metalness: 0.5
                });
                loadFBXModel();
            }).catch((error) => {
                console.error('Error loading textures:', error);
            });
        }

        // Load FBX model and apply material
        function loadFBXModel() {
            fbxLoader.load('models/planet.fbx', (fbx) => {
                fbx.traverse((child) => {
                    if (child.isMesh) {
                        child.material = material;
                    }
                });
                scene.add(fbx);
                console.log('FBX model loaded successfully');
            }, undefined, (error) => {
                console.error('Error loading FBX model:', error);
            });
        }

        // Function to update textures dynamically
        function updateTextures(diffusePath, normalPath, roughnessPath) {
            Promise.all([
                new Promise((resolve, reject) => {
                    ddsLoader.load(diffusePath, resolve, undefined, reject);
                }).then((texture) => {
                    diffuseTexture = texture;
                    material.map = diffuseTexture;
                }),
                new Promise((resolve, reject) => {
                    ddsLoader.load(normalPath, resolve, undefined, reject);
                }).then((texture) => {
                    normalTexture = texture;
                    material.normalMap = normalTexture;
                }),
                new Promise((resolve, reject) => {
                    ddsLoader.load(roughnessPath, resolve, undefined, reject);
                }).then((texture) => {
                    roughnessTexture = texture;
                    material.roughnessMap = roughnessTexture;
                })
            ]).then(() => {
                material.needsUpdate = true;
                console.log('Textures updated successfully');
            }).catch((error) => {
                console.error('Error updating textures:', error);
            });
        }

        // Ambient atmosphere light
        const atmosphereLight = new THREE.RectAreaLight(0x0000ff, 1, 2, 2);
        atmosphereLight.position.set(-1, 0, 0);
        atmosphereLight.lookAt(0, 0, 0);
        scene.add(atmosphereLight);

        // Add directional light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 0.5, 0.5).normalize();
        scene.add(directionalLight);

        // Animation function
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Start animation
        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

        // Function to update camera position from the console
        window.updateCameraPosition = function(x, y, z) {
            camera.position.set(x, y, z);
            camera.lookAt(0, 0, 0);
            console.log(`Camera position updated to: x=${x}, y=${y}, z=${z}`);
        };

        // Function to update directional light position from the console
        window.updateLightPosition = function(x, y, z) {
            directionalLight.position.set(x, y, z).normalize();
            console.log(`Light position updated to: x=${x}, y=${y}, z=${z}`);
        };

        console.log("Use the updateCameraPosition(x, y, z) function to change the camera position.");
        console.log("Use the updateLightPosition(x, y, z) function to change the light position.");

        // Load initial textures and initialize scene
        loadTexturesAndInitialize();
    </script>
</body>
</html>
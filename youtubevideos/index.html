<html>
	<head>
		<title>JDWhittall</title>
		<link rel="stylesheet" href="/style/stylesheet.css">
		<link rel="stylesheet" href="/style/youtubeteststyle.css">
		<script src="https://www.w3schools.com/lib/w3.js"></script>

		<!-- Featured Video Test -->

		<script src="https://apis.google.com/js/api.js"></script>

		<script>

			var pageToken = '';
			var loaded = false;
			var finishedLoading = false;
			var videos=[];
			var pages;
			var currentPage;
			var descending;

			function loadClient() {
    			gapi.client.setApiKey('AIzaSyBzwpMSGuPd17Bsg1r3Hainyu9TaNTCPaQ');
    			isLoaded();
    			return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest").then(function() { console.log("GAPI client loaded for API"); execute(); },function(err) { console.error("Error loading GAPI client for API", err); });
    			}

    		function isLoaded(){

    			loaded = true;
    		}

    		var test;

    			// Make sure the client is loaded before calling this method.
  			function execute() {

				if(finishedLoading){
					return;
				}

				var request = gapi.client.youtube.playlistItems.list({
    				"part": [
    					"snippet"
    				],
    				"maxResults": 50,
    				"pageToken": pageToken,
    				"playlistId": "PL1tiwbzkOjQxD0jjAE7PsWoaCrs0EkBH2"
    			})
    				.then(function(response) {
               			// Handle the results here (response.result has the parsed body).
                		pageToken = response.result.nextPageToken;
                		for (var i = 0; i < response.result.items.length; i++) {
                			videos.push(response.result.items[i]);
                		}
                		if(response.result.items.length < 50){
                			console.log("loaded all videos");
                			finishedLoading = true;
                			pages = Math.ceil(videos.length / 9) - 1;
                			currentPage = 0;
                			console.log(videos);
                			console.log(pages);
                			loadVid();
                		}else{
                			execute();
                		}
              		},
              		function(err) { console.error("Execute error", err); });
			}

			gapi.load("client");

			function checkVideos(){
				console.log(videos);
			}

    		function loadVid(){
    			var video = videos[videos.length - 1].snippet.resourceId.videoId;
    			var link = 'https://www.youtube.com/embed/' + video;
    			var element = document.getElementById("latestVid");

    			element.innerHTML = '<center><iframe width="1024px" height="576px" src=' + link + '  title="YouTube video player" frameborder="0" allowfullscreen></iframe></center>';
    			VideoGalleryDescend();
    		}

    		function CurrentVideo(videoLink){
    			var video = videos[videoLink - 1].snippet.resourceId.videoId;
    			var link = 'https://www.youtube.com/embed/' + video;
    			var element = document.getElementById("latestVid");

    			element.innerHTML = '<center><iframe width="1024px" height="576px" src=' + link + '  title="YouTube video player" frameborder="0" allowfullscreen></iframe></center>';
    			window.scrollTo({top: 0, behavior: 'smooth'});
    		}

    		function VideoGallery(){
    			console.log("Ascend");
    			var element = document.getElementById("gallery");
    			element.innerHTML = '';
    			var startFrom = currentPage*9;
    			console.log(startFrom + " " + (startFrom+8));
    			for (var i = startFrom; i < startFrom+9; i++) {
    				if(i > videos.length - 1) return;
    				element.innerHTML += '<div class="video"><a onclick="CurrentVideo(' + (i + 1) + ')" style="cursor:pointer;"><img class="image" src="' + videos[i].snippet.thumbnails.high.url + '" alt=""></a></div>';
    			}
    		}

    		function VideoGalleryDescend(){
    			console.log("Descend");
    			var element = document.getElementById("gallery");
    			element.innerHTML = '';
    			var startFrom = currentPage*9;
    			var reversedVideos = videos.reverse();
    			console.log(startFrom + " " + (startFrom+8));
    			for (var i = startFrom; i < startFrom+9; i++) {
    				if(i > reversedVideos.length - 1) return;
    				element.innerHTML += '<div class="video"><a onclick="CurrentVideo(' + (i + 1) + ')" style="cursor:pointer;"><img class="image" src="' + reversedVideos[i].snippet.thumbnails.high.url + '" alt=""></a></div>';
    			}
    		}

    		function testPage(direction){
    			if(!direction){
    				currentPage++;
    			}else{
    				currentPage--;
    			}
    			if(currentPage > pages){
    				currentPage = pages;
    			}else if(currentPage < 0){
    				currentPage = 0;
    			}

    			console.log(currentPage);
    			VideoGalleryDescend();
    		}

    	</script>
	</head>
	<body onload="loadClient()">
		<div><h1>Video Display Test</h1></div>
		<div id="latestVid" class="FeaturedVideo">

		</div>
		<div id="gallery" class="videoGallery">
			<div class="video">
				<a onclick="CurrentVideo(143)" style="cursor:pointer;">
					<img class="image" src="" alt="">
				</a>
			</div>
		</div>
		<center>
		<div class="pagination">
			<a onclick="testPage(true)"><</a>
			<a onclick="testPage(false)">></a>
		</div>
		</center>
	</body>
</html>
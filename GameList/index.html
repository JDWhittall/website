<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="gameliststyle.css">
</head>
<body>
  <header>
    <h1>Game Library</h1>
    <nav>
      <a href="addnewgame.html">Add New Game</a>
    </nav>
  </header>

  <main>
    <section id="controls">
      <label>
        Owner:
        <select id="owner-filter">
          <option value="">All owners</option>
        </select>
      </label>

      <label>
        Search:
        <input id="search-input" type="search" placeholder="Name, genre, notes…">
      </label>
    </section>

    <div id="games-status">Loading games…</div>
    <section id="games-list" class="game-grid"></section>
	<pre id="output"></pre>

  </main>

  <script>
const BASE_URL = "https://script.google.com/macros/s/AKfycbxURFaWZ8gz-TZ-Jtep-4zkOiKK95bobxKaCDgfzQU0kPmn3QFKZj24cO6x2BXImM2U8w/exec";

async function fetchOwners() {
  const res = await fetch(`${BASE_URL}?type=owners`);
  const owners = await res.json();
  const map = new Map();

  owners.forEach((owner) => {
    const key = (owner.name || "").trim().toLowerCase();
    if (key) {
      map.set(key, owner.avatarUrl || "");
    }
  });

  return map;
}

async function fetchGames() {
  const res = await fetch(BASE_URL, { method: "GET" });
  return res.json();
}

function renderOwners(rawOwners, ownersMap) {
  const names = (rawOwners || "")
    .split(",")
    .map((n) => n.trim())
    .filter(Boolean);

  if (!names.length) {
    return `<span class="owner-chip owner-chip--missing" title="Owner unknown"><span class="owner-initial">?</span></span>`;
  }

  return names
    .map((name) => {
      const avatar = ownersMap.get(name.toLowerCase());
      if (avatar) {
        return `<span class="owner-chip owner-chip--avatar" title="${name}">
          <img src="${avatar}" alt="${name} avatar">
        </span>`;
      }
      const initial = name.charAt(0).toUpperCase() || "?";
      return `<span class="owner-chip owner-chip--missing" title="${name}">
        <span class="owner-initial">${initial}</span>
      </span>`;
    })
    .join("");
}

async function loadGames() {
  const statusEl = document.getElementById("games-status");
  const listEl = document.getElementById("games-list");
  statusEl.textContent = "Loading games...";

  try {
    const [ownersMap, games] = await Promise.all([fetchOwners(), fetchGames()]);
    listEl.innerHTML = "";

    games.forEach((item) => {
      const card = document.createElement("div");
      card.className = "game-card";

      card.innerHTML = `
  <div class="cover-div">
    <img src="${item.imageUrl}"
         class="game-cover"
         alt="Cover image for ${item.gameName}">
  </div>

  <div class="game-description">
    <h2>${item.gameName}</h2>
    <p>${item.description}</p>
    <div class="game-info">
      <span><img src="images/players.png" style="height:1.5rem; width:auto;"><span style="vertical-align: top;"> ${item.players} players</span></span>
      <span style="vertical-align: top;margin-left:1rem;margin-right:1rem;"> | </span>
      <span><img src="images/timer.png" style="height:1.5rem; width:auto;"><span style="vertical-align: top;"> ${item.playtime} minutes</span></span>
    </div>
    <div class="other-info">
      ${item.scoreSheet ? `<a href="${item.scoreSheet}" target="_blank" rel="noopener">Score Sheet</a>` : ""}
      <div class="owner-list">${renderOwners(item.owners, ownersMap)}</div>
    </div>
    
  </div>
`;

      listEl.appendChild(card);
    });

    statusEl.textContent = "";
  } catch (err) {
    statusEl.textContent = "Error loading data";
    console.error(err);
  }
}

window.onload = loadGames;
  </script>
</body>
</html>
